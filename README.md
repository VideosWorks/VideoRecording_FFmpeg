# myVideoRecordingDemo
JsonYang  and  HongpingZhao

```mermaid
graph TD
START[开始] -->|输入:设备名称,采集视屏宽高,采样率| PARCHECK{参数检验}
PARCHECK -->|成功| CRE_THRED_MGR[创建线程管理对象,及SDL渲染线程]
PARCHECK -->|失败| EXIT[退出]
CRE_THRED_MGR --> SDL_EVENT_THREAD[创建SDL事件循环线程]
SDL_EVENT_THREAD-->SDL_EVENT_WAIT[SDL事件监听]
SDL_EVENT_WAIT-->SDL_CHECK_EXIT{是否退出}
SDL_CHECK_EXIT-->|是|EXIT_EVENT_LOOP[退出SDL事件循环]
SDL_CHECK_EXIT-->|否| GET_DATA_FROM_QUEU[从渲染数据队列获取数据]
GET_DATA_FROM_QUEU-->RENDER_AND_AUDIO_OUTPUT[视屏贴图渲染,音频输出]
RENDER_AND_AUDIO_OUTPUT-->SDL_ERROR{错误异常}
SDL_ERROR-->|是|EXIT_EVENT_LOOP
SDL_ERROR-->|否|GET_DATA_FROM_QUEU
CRE_THRED_MGR-->DATA_CAP_THREAD_CREATE[创建数据采集线程]
SDL_DATA_SAVE_THREAD_CREATE[创建数据存储线程]-->DATA_CAP_INIT[数据存储初始化]
CRE_THRED_MGR-->SDL_DATA_SAVE_THREAD_CREATE
DATA_SAVE_QUEUE[存储数据队列事件]-->DATA_GET_FROM_DATA_QUEUE[从存储数据队列获取数据]
DATA_CAP_INIT-->DATA_SAVE_QUEUE
DATA_GET_FROM_DATA_QUEUE-->ECODE_TO_FILE[编码输出数据到文件]
DATA_SAVE_IS_NOT_EXIT{是否退出}-->|是|REFRASH_CLOSE_HANDLE[刷新编码器,清理内存,关闭资源]
ECODE_TO_FILE-->DATA_SAVE_IS_NOT_EXIT
DATA_SAVE_IS_NOT_EXIT-->|否|DATA_SAVE_QUEUE
REFRASH_CLOSE_HANDLE-->SUSPEND_DATA_SAVE[暂停数据采集动作,等待下次启动]
DATA_CAP_THREAD_CREATE-->|输入设备名称,采集宽高,采样率|OPREATE_VIDEO_CAP_RESET[执行视频采集重置事件]
OPREATE_VIDEO_CAP_RESET-->INIT_FFPEG[初始化FFMPEG]
INIT_FFPEG-->REGISTER_CAP_TIMER[根据采样率,注册数据采集定时器]
REGISTER_CAP_TIMER-->OPREATE_VIDEO_DATA_CAP[处理视频数据采集定时任务]
DATA_CAP_THREAD_CREATE-->OPREATE_VIDEO_SAVE_EVENT[处理视频数据存储任务]
OPREATE_VIDEO_SAVE_EVENT-->SEND_VIDEO_SAVE_PARAM[发送视频存储参数]
SEND_VIDEO_SAVE_PARAM-->DATA_CAP_INIT
READ_VIDEO_DATA[读取视屏数据]-->DECODE_VIDEO[解码数据]
DECODE_VIDEO-->CAVER_TO_YUV420P[转码YUV420P]
OPREATE_VIDEO_DATA_CAP-->READ_VIDEO_DATA
CHECK_IS_SAVE{检查是否存储}-->|是|DATA_SAVE_QUEUE
CAVER_TO_YUV420P-->CHECK_IS_SAVE
CAVER_TO_YUV420P-->GET_DATA_FROM_QUEU
